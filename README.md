# Инструменты для обработки открытых данных студентов ИРНИТУ

Веб-приложение для анализа и визуализации данных об успеваемости студентов Иркутского национального исследовательского технического университета.

## Оглавление

- [Описание проекта](#описание-проекта)
- [Технологический стек](#технологический-стек)
- [Требования](#требования)
- [Установка и настройка](#установка-и-настройка)
- [Структура проекта](#структура-проекта)
- [Архитектура приложения](#архитектура-приложения)
- [Основные компоненты](#основные-компоненты)
- [API интеграция](#api-интеграция)
- [Авторизация](#авторизация)
- [Разработка](#разработка)
- [Сборка для production](#сборка-для-production)
- [Конфигурация](#конфигурация)

## Описание проекта

Приложение предоставляет инструменты для анализа академических данных студентов, включая:

- **Статистика оценок**: Визуализация и анализ успеваемости с фильтрацией по курсам, семестрам, группам и предметам
- **Академический отпуск**: Отслеживание студентов в академическом отпуске и их успеваемости
- **Статистика по предметам**: Детальная аналитика по отдельным дисциплинам
- **Рейтинг студентов**: Ранжирование студентов по успеваемости с различными критериями сортировки

## Технологический стек

### Основные зависимости

- **Vue.js 3.3.0**: Прогрессивный JavaScript-фреймворк для создания пользовательских интерфейсов
- **Vite 4.0.0**: Сборщик и dev-сервер для современной веб-разработки
- **Bootstrap 5.3.0**: CSS-фреймворк для создания адаптивного интерфейса
- **Chart.js 4.0.0**: Библиотека для построения графиков и диаграмм

### Дополнительные библиотеки

- **vue-router 4.0.3**: Маршрутизация для одностраничных приложений
- **vuex 4.0.0**: Централизованное управление состоянием
- **papaparse 5.4.0**: Парсинг CSV файлов
- **@mdi/font 7.4.47**: Material Design Icons
- **@popperjs/core 2.11.8**: Позиционирование выпадающих элементов

## Требования

- Node.js версии 16.0 или выше
- npm версии 7.0 или выше
- Python 3.8 или выше (для Django backend)
- Django backend сервер, запущенный на порту 8000

**Важно:** Для работы приложения необходимо развернуть и запустить Django backend. Репозиторий бэкенда доступен по адресу: [https://github.com/dogee4803/IRNTU-Dashboard_django_backend](https://github.com/dogee4803/IRNTU-Dashboard_django_backend)

## Установка и настройка

### 1. Установка и настройка Django Backend

**Обязательный шаг:** Перед запуском фронтенд приложения необходимо развернуть и запустить Django backend.

#### 1.1. Клонирование репозитория бэкенда

```bash
git clone https://github.com/dogee4803/IRNTU-Dashboard_django_backend.git
cd IRNTU-Dashboard_django_backend
```

#### 1.2. Создание и активация виртуального окружения

**Windows:**
```bash
<Путь к проекту>\venv\Scripts\activate
# или
<Путь к проекту>\venv\Scripts\Activate.ps1
```

**Linux/macOS:**
```bash
source <Путь к проекту>/venv/bin/activate
```

#### 1.3. Установка зависимостей

```bash
pip install -r requirements.txt
```

#### 1.4. Применение миграций

```bash
python manage.py makemigrations
python manage.py migrate
```

#### 1.5. Создание суперпользователя

Для авторизации в приложении необходимо создать администратора Django:

```bash
python manage.py createsuperuser
```

Создайте супер пользователя по инструкции в терминале и введите поля ввода для email (логина) и для пароля. Эти данные будут использоваться для входа в фронтенд приложение.

#### 1.6. Запуск Django сервера

```bash
python manage.py runserver
```

Сервер будет доступен по адресу `http://127.0.0.1:8000`. Убедитесь, что сервер запущен перед запуском фронтенд приложения.

### 2. Установка зависимостей фронтенд приложения

```bash
npm install
```

### 3. Настройка переменных окружения

В файле `vite.config.js` настроен прокси для API запросов. По умолчанию бэкенд ожидается на `http://127.0.0.1:8000`. При необходимости измените параметры в секции `server.proxy`.

### 4. Запуск development сервера

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173`. Сервер автоматически откроет браузер при запуске.

**Убедитесь, что Django backend сервер запущен и доступен на порту 8000 перед запуском фронтенд приложения.**

### 5. Запуск production сборки

```bash
npm run build
```

Собранные файлы будут находиться в директории `dist/`.

## Структура проекта

```
VueFront/
├── public/                 # Статические файлы
│   ├── datasets/          # CSV файлы с данными
│   └── favicon.ico        # Иконка сайта
├── src/
│   ├── assets/            # Ресурсы (изображения, шрифты)
│   │   └── istu_logo.png  # Логотип ИРНИТУ
│   ├── components/        # Переиспользуемые компоненты
│   │   ├── UI/            # UI компоненты (кнопки, инпуты, диалоги)
│   │   ├── ChartComponent.vue
│   │   ├── ChartFilter.vue
│   │   ├── Pagination.vue
│   │   └── PerPageSelector.vue
│   ├── views/             # Страницы приложения
│   │   ├── StatisticsView.vue        # Статистика оценок
│   │   ├── AcademicLeaveView.vue     # Академический отпуск
│   │   ├── SubjectStatsView.vue      # Статистика по предметам
│   │   └── StudentRatingView.vue     # Рейтинг студентов
│   ├── app.vue            # Корневой компонент приложения
│   └── main.js            # Точка входа приложения
├── index.html             # HTML шаблон
├── vite.config.js         # Конфигурация Vite
├── package.json           # Зависимости и скрипты
└── README.md              # Документация
```

## Архитектура приложения

### Компонентная архитектура

Приложение построено на основе компонентной архитектуры Vue.js 3 с использованием Composition API:

- **Корневой компонент** (`app.vue`): Управляет навигацией, авторизацией и общим состоянием приложения
- **View компоненты**: Отвечают за отображение конкретных разделов приложения
- **Переиспользуемые компоненты**: Используются в различных views для обеспечения единообразия интерфейса

### Управление состоянием

Приложение использует комбинацию подходов для управления состоянием:

- **Provide/Inject**: Для передачи функции `fetchData` и константы `API_BASE_URL` дочерним компонентам
- **Reactive refs**: Для локального состояния компонентов
- **localStorage**: Для сохранения токенов авторизации и данных пользователя

### Маршрутизация

Навигация реализована через условное отображение компонентов на основе значения `activeTab` в корневом компоненте, а не через Vue Router (хотя библиотека установлена для возможного расширения функциональности).

## Основные компоненты

### Корневой компонент (app.vue)

**Ответственность:**
- Управление навигацией между разделами
- Авторизация пользователей
- Загрузка опций для фильтров (группы, предметы)
- Предоставление API функций дочерним компонентам

**Ключевые функции:**
- `login()`: Авторизация пользователя
- `logout()`: Выход из системы
- `fetchData()`: Универсальная функция для API запросов с обработкой ошибок и обновлением токенов
- `loadFilterOptions()`: Загрузка списков групп и предметов
- `refreshAccessToken()`: Обновление access token при истечении срока действия

### StatisticsView

**Назначение:** Отображение статистики оценок с возможностью фильтрации и пагинации.

**Основные возможности:**
- Фильтрация по курсу, семестру, группе, предмету
- Поиск по имени студента
- Сортировка данных
- Визуализация статистики через Chart.js
- Пагинация результатов

**API эндпоинт:** `/api/statistics/marks/`

### AcademicLeaveView

**Назначение:** Управление информацией об академическом отпуске студентов.

**Подразделы:**
- **Успеваемость**: Анализ успеваемости студентов в академическом отпуске
- **Даты возврата**: Отслеживание дат возврата студентов из академического отпуска

**API эндпоинты:**
- `/api/academic/performance/`
- `/api/academic/returns/`

### SubjectStatsView

**Назначение:** Детальная статистика по отдельным предметам.

**Основные возможности:**
- Фильтрация по курсу, семестру, предмету
- Сортировка предметов по среднему баллу, количеству студентов
- Визуализация распределения оценок
- Отображение статистики (мин, средний, макс баллы)

**API эндпоинт:** `/api/statistics/subject/`

### StudentRatingView

**Назначение:** Рейтинг студентов по успеваемости.

**Основные возможности:**
- Фильтрация по курсу, группе, предмету
- Различные критерии сортировки (рейтинг, средний балл)
- Визуализация рейтинга через графики
- Табличное отображение с пагинацией

**API эндпоинт:** `/api/student-rating/`

### Переиспользуемые компоненты

#### ChartComponent.vue
Компонент для отображения графиков на основе Chart.js. Поддерживает различные типы диаграмм (bar, line, pie).

#### Pagination.vue
Компонент пагинации для навигации по страницам данных.

#### PerPageSelector.vue
Селектор количества элементов на странице.

#### UI компоненты (MyButton, MyInput, MySelect, MyDialog)
Базовые UI компоненты для единообразия интерфейса.

## API интеграция

### Конфигурация

Базовый URL API задается константой `API_BASE_URL = '/api'` в `app.vue`. Прокси настроен в `vite.config.js` для перенаправления всех запросов с префиксом `/api` на Django backend (`http://127.0.0.1:8000`).

### Функция fetchData

Универсальная функция для выполнения API запросов, предоставляемая через `provide/inject`:

```javascript
fetchData(url, options, isRetry)
```

**Особенности:**
- Автоматическое добавление токена авторизации в заголовки
- Обработка ошибок 401 (Unauthorized)
- Автоматическое обновление токена при истечении срока действия
- Повторная попытка запроса после обновления токена
- Обработка различных типов ошибок API

### Эндпоинты API

#### Авторизация
- `POST /api/login/` - Авторизация пользователя
- `POST /api/auth/token/refresh/` - Обновление access token

#### Данные для фильтров
- `GET /api/groups/` - Список групп
- `GET /api/disciples/` - Список предметов

#### Статистика
- `GET /api/statistics/marks/` - Статистика оценок
- `GET /api/statistics/subject/` - Статистика по предметам
- `GET /api/student-rating/` - Рейтинг студентов

#### Академический отпуск
- `GET /api/academic/performance/` - Успеваемость студентов в академическом отпуске
- `GET /api/academic/returns/` - Даты возврата из академического отпуска

### Формат запросов и ответов

Все запросы используют формат JSON. Заголовки:
- `Content-Type: application/json`
- `Accept: application/json`
- `Authorization: Bearer <token>` (для защищенных эндпоинтов)

Ответы от сервера также в формате JSON.

## Авторизация

### Механизм авторизации

Приложение использует JWT (JSON Web Tokens) для аутентификации:

1. **Access Token**: Короткоживущий токен для доступа к защищенным ресурсам
2. **Refresh Token**: Долгоживущий токен для обновления access token

### Создание учетной записи для авторизации

Для работы с приложением необходимо создать суперпользователя в Django backend:

```bash
python manage.py createsuperuser
```

Введите email (будет использоваться как логин) и пароль. Эти учетные данные потребуются для входа в фронтенд приложение.

**Важно:** На текущий момент для авторизации используются учетные данные администратора Django (суперпользователя).

### Процесс авторизации

1. Пользователь вводит email (логин) и пароль в модальном окне авторизации
2. Отправляется POST запрос на `/api/login/` с данными авторизации
3. При успешной авторизации сохраняются токены (access и refresh) в localStorage
4. Токены автоматически добавляются в заголовки последующих API запросов

### Обновление токенов

При получении ответа 401 (Unauthorized):
1. Автоматически отправляется запрос на обновление токена
2. При успехе - повторяется исходный запрос
3. При неудаче - пользователь перенаправляется на страницу авторизации

### Хранение данных

- `localStorage.accessToken`: Access token
- `localStorage.refreshToken`: Refresh token
- `localStorage.userData`: Данные пользователя (имя, email)

## Разработка

### Запуск dev-сервера

```bash
npm run dev
```

Сервер запускается на `http://localhost:5173` с поддержкой:
- Hot Module Replacement (HMR)
- Автоматической перезагрузки при изменении файлов
- Прокси для API запросов

### Структура работы с компонентами

#### Создание нового View компонента

1. Создайте файл в `src/views/YourView.vue`
2. Используйте `inject` для получения `fetchData` и `API_BASE_URL`:

```javascript
const fetchData = inject('fetchData');
const API_BASE_URL = inject('API_BASE_URL');
```

3. Добавьте компонент в `app.vue`:
   - Импортируйте через `defineAsyncComponent`
   - Добавьте case в `currentViewComponent` computed property
   - Добавьте вкладку в навигацию

#### Стилизация

- Используйте Bootstrap 5 классы для базовой стилизации
- Кастомные стили добавляйте в секцию `<style>` компонента
- Material Icons используются для иконок (подключены через Google Fonts)

### Обработка ошибок

Все API запросы должны обрабатывать ошибки через try/catch блоки:

```javascript
try {
  const data = await fetchData(`${API_BASE_URL}/endpoint/`);
  // Обработка данных
} catch (err) {
  error.value = err.message || 'Сообщение об ошибке';
}
```

## Сборка для production

### Создание production сборки

```bash
npm run build
```

Сборка создает оптимизированные файлы в директории `dist/`, включая:
- Минифицированный JavaScript
- Оптимизированные CSS
- Обработанные ассеты

### Развертывание

Файлы из директории `dist/` можно развернуть на любом статическом хостинге (nginx, Apache, Vercel, Netlify и т.д.).

**Важно:** При развертывании необходимо убедиться, что:
1. API backend доступен и URL настроен корректно
2. CORS настроен на бэкенде для домена production
3. Прокси настроен на веб-сервере или используется корректный `API_BASE_URL`

## Конфигурация

### vite.config.js

Основные параметры конфигурации:

```javascript
{
  server: {
    host: '0.0.0.0',        // Доступ со всех интерфейсов
    port: 5173,              // Порт dev-сервера
    proxy: {
      '/api': {
        target: 'http://127.0.0.1:8000',  // Django backend
        changeOrigin: true
      }
    }
  },
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  }
}
```

### Изменение базового URL API

Если необходимо изменить базовый URL API (например, для production), измените константу `API_BASE_URL` в `src/app.vue`:

```javascript
const API_BASE_URL = 'https://api.example.com';  // Для production
```

Или настройте переменную окружения в зависимости от режима работы.

## Поддержка

При возникновении проблем проверьте:

1. Запущен ли Django backend сервер на порту 8000
2. Правильно ли настроен прокси в `vite.config.js`
3. Доступны ли API эндпоинты (проверьте через браузер или curl)
4. Валидны ли токены авторизации в localStorage
5. Создан ли суперпользователь в Django backend для авторизации

### Связанные проекты

- **Django Backend**: [https://github.com/dogee4803/IRNTU-Dashboard_django_backend](https://github.com/dogee4803/IRNTU-Dashboard_django_backend)
  
  Репозиторий содержит Django приложение, которое предоставляет API для фронтенд приложения. Обязательно разверните и запустите бэкенд перед работой с фронтенд приложением.

## Лицензия

Проект разработан для Иркутского национального исследовательского технического университета.
